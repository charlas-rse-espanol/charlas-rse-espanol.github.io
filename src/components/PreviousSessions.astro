---
import { siteConfig } from "../config";

// Sort sessions by date (most recent first) and take only the last 6
const allSessions = siteConfig.previousSessions;
const sortedSessions = [...allSessions].sort((a, b) => {
  const dateA = new Date(a.date);
  const dateB = new Date(b.date);
  return dateB.getTime() - dateA.getTime();
});
const sessions = sortedSessions.slice(0, 6);
---

<section id={siteConfig.sections.previousSessions.id} class="p-8 sm:p-12 md:p-16 lg:p-24 bg-gray-50">
  <div class="space-y-8">
    <div>
      <h2 class="text-2xl sm:text-3xl md:text-4xl xl:text-5xl font-bold text-gray-900">
        {siteConfig.sections.previousSessions.title}
      </h2>
      <div
        class="w-[75px] h-[5px] mt-2 rounded-full"
        style={`background-color: ${siteConfig.accentColor}`}
      />
      <p class="mt-4 text-base text-gray-600">
        Browse our collection of past talks from amazing speakers across the Spanish-speaking world üóìÔ∏è
      </p>
    </div>
    <div>
      <div class="mx-auto max-w-7xl px-2">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {sessions.map((session, index) => {
            // Find the original index for linking to the full session
            const originalIndex = allSessions.findIndex(s => s.name === session.name && s.date === session.date);
            return (
              <div class="group relative h-full max-w-lg mx-auto">
                <div
                  class="block relative bg-white rounded-xl border border-gray-200 transition-all duration-300 overflow-hidden h-full flex flex-col min-h-[400px] hover:bg-gray-50 hover:shadow-xl hover:border-gray-300 hover:-translate-y-1"
                >
                  <!-- Date Badge -->
                  <div class="absolute top-4 right-4 z-10">
                    <div class="px-3 py-1.5 bg-white/90 backdrop-blur-sm rounded-full text-xs font-bold text-gray-700 shadow-sm border border-gray-200">
                      {session.date}
                    </div>
                  </div>

                  <!-- Speaker Header -->
                  <div class="p-6 flex-shrink-0" style={`background: linear-gradient(135deg, ${siteConfig.accentColor}20 0%, ${siteConfig.accentColor}08 100%)`}>
                    <h3 class="text-xl font-bold text-gray-900 mb-1">
                      {session.name}
                    </h3>
                    <p class="text-sm text-gray-700 font-medium">
                      {session.institution}
                    </p>
                  </div>
                  
                  <div class="p-6 flex-1 flex flex-col">
                    <!-- Title -->
                    <div class="mb-3">
                      <h4 class="text-base font-semibold text-gray-800 leading-snug italic">
                        "{session.title}"
                      </h4>
                    </div>

                    <!-- Skills Tags -->
                    {session.skills && session.skills.length > 0 && (
                      <div class="flex flex-wrap gap-1.5 mb-3">
                        {session.skills.map((skill) => (
                          <span
                            class="px-2 py-1 bg-gray-100 text-gray-700 rounded-md text-xs font-medium transition-all duration-300 group-hover:bg-gray-200"
                          >
                            {skill}
                          </span>
                        ))}
                      </div>
                    )}

                    <!-- Action Links -->
                    <div class="mt-auto pt-4 space-y-2">
                      <!-- See More Link -->
                      <a
                        href={`/sessions#session-${originalIndex}`}
                        class="flex items-center justify-start text-sm font-bold transition-all duration-300 hover:translate-x-1"
                        style={`color: ${siteConfig.accentColor}`}
                      >
                        <span>See more</span>
                        <svg
                          class="w-4 h-4 ml-1 transition-transform duration-300"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 5l7 7-7 7"
                          />
                        </svg>
                      </a>

                      <!-- Slides Link -->
                      {session.slidesLink && session.slidesLink !== "" && (
                        <a
                          href={session.slidesLink}
                          target="_blank"
                          rel="noopener noreferrer"
                          class="flex items-center justify-start text-sm font-medium text-gray-600 transition-all duration-300 hover:text-blue-600"
                        >
                          <span>View slides</span>
                          <svg
                            class="w-4 h-4 ml-1 transition-transform duration-300"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="2"
                              d="M7 17L17 7M17 7H7M17 7V17"
                            />
                          </svg>
                        </a>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      </div>

      <!-- View All Sessions Button -->
      <div class="mt-12 text-center">
        <a
          href="/sessions"
          class="inline-flex items-center justify-center gap-2 px-8 py-4 rounded-lg font-bold text-white text-lg transition-all duration-300 hover:shadow-lg hover:scale-105"
          style={`background-color: ${siteConfig.accentColor}`}
        >
          <span>View all sessions</span>
          <svg
            class="w-5 h-5 transition-transform duration-300"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"
            />
          </svg>
        </a>
      </div>
    </div>
  </div>
</section>

<style>
  details summary::-webkit-details-marker {
    display: none;
  }
  
  /* Custom scrollbar for expanded content */
  details div::-webkit-scrollbar {
    width: 6px;
  }
  
  details div::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }
  
  details div::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 10px;
  }
  
  details div::-webkit-scrollbar-thumb:hover {
    background: #555;
  }
</style>

