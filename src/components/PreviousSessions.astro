---
import { siteConfig } from "../config";

// Sort sessions by date (most recent first) and take only the last 6
const allSessions = siteConfig.previousSessions;
const sortedSessions = [...allSessions].sort((a, b) => {
  const dateA = new Date(a.date);
  const dateB = new Date(b.date);
  return dateB.getTime() - dateA.getTime();
});
const sessions = sortedSessions.slice(0, 6);
---

<section id={siteConfig.sections.previousSessions.id} class="p-8 sm:p-12 md:p-16 lg:p-24 bg-gray-50">
  <div class="space-y-8">
    <div>
      <h2 class="text-2xl sm:text-3xl md:text-4xl xl:text-5xl font-bold text-gray-900">
        {siteConfig.sections.previousSessions.title}
      </h2>
      <div
        class="w-[75px] h-[5px] mt-2 rounded-full"
        style={`background-color: ${siteConfig.accentColor}`}
      />
      <p class="mt-10 text-base sm:text-lg md:text-xl text-gray-600 max-w-6xl">
        Browse our collection of past talks from amazing speakers across the Spanish-speaking world
      </p>
    </div>
    <div>
      <div class="mx-auto max-w-7xl px-2">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {sessions.map((session, index) => {
            // Find the original index for linking to the full session
            const originalIndex = allSessions.findIndex(s => s.name === session.name && s.date === session.date);
            return (
              <div class="group relative h-full w-full">
                <a
                  href={`/sessions#session-${originalIndex}`}
                  class="block relative bg-white rounded-xl border border-gray-200 transition-all duration-300 overflow-hidden h-full flex flex-col min-h-[350px] hover:bg-gray-50 hover:shadow-xl hover:border-gray-300 hover:-translate-y-1"
                >
                  <!-- Date badge -->
                  <div class="absolute top-2 right-2 z-10 flex items-center gap-1.5 text-sm font-bold" style={`color: ${siteConfig.accentColor}`}>
                    <svg 
                      xmlns="http://www.w3.org/2000/svg" 
                      class="w-4 h-4 flex-shrink-0" 
                      viewBox="0 0 24 24" 
                      fill="none" 
                      stroke="currentColor" 
                      stroke-width="2" 
                      stroke-linecap="round" 
                      stroke-linejoin="round"
                    >
                      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                      <path d="M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z" />
                      <path d="M16 3v4" />
                      <path d="M8 3v4" />
                      <path d="M4 11h16" />
                    </svg>
                    <span>{session.date}</span>
                  </div>

                  <!-- Speaker header -->
                  <div class="px-5 pb-5 flex-shrink-0" style={`background: linear-gradient(135deg, ${siteConfig.accentColor}20 0%, ${siteConfig.accentColor}08 100%)`}>
                    <div class="pt-12 mb-3">
                      <h3 class="text-lg sm:text-xl font-bold text-gray-900 leading-snug">
                        {session.name}
                      </h3>
                      <p class="text-base sm:text-lg font-semibold text-gray-700 italic mt-1">
                        {session.title}
                      </p>
                    </div>
                    <p class="text-sm text-gray-700 font-medium">
                      {session.institution}
                    </p>
                  </div>
                  
                  <div class="p-5 flex-1 flex flex-col">
                    <!-- Skills tags -->
                    {session.skills && session.skills.length > 0 && (
                      <div class="flex flex-wrap gap-1.5 mb-3">
                        {session.skills.map((skill) => (
                          <span
                            class="px-2 py-1 bg-gray-100 text-gray-700 rounded-md text-xs font-medium transition-all duration-300 group-hover:bg-gray-200"
                          >
                            {skill}
                          </span>
                        ))}
                      </div>
                    )}

                  </div>
                </a>

                <!-- Slides link - positioned absolutely at bottom right -->
                {session.slidesLink && session.slidesLink !== "" && (
                  <a
                    href={session.slidesLink}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="absolute bottom-4 right-4 z-20 flex items-center gap-1.5 px-3 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 shadow-sm transition-all duration-300 hover:bg-gray-100 hover:border-gray-400 hover:shadow-md"
                    onclick="event.stopPropagation()"
                  >
                    <svg
                      class="w-4 h-4"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                      />
                    </svg>
                    <span>View slides</span>
                  </a>
                )}
              </div>
            );
          })}
        </div>
      </div>

      <!-- View all sessions link -->
      <div class="mt-12 text-center">
        <a
          href="/sessions"
          class="inline-flex items-center gap-2 text-lg sm:text-xl md:text-2xl font-bold hover:opacity-80 transition-opacity group"
          style={`color: ${siteConfig.accentColor}`}
        >
          <span>View all sessions</span>
          <svg
            class="w-5 h-5 sm:w-6 sm:h-6 md:w-7 md:h-7 transition-transform group-hover:translate-x-1"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"
            />
          </svg>
        </a>
      </div>
    </div>
  </div>
</section>

<style>
  details summary::-webkit-details-marker {
    display: none;
  }
  
  /* Custom scrollbar for expanded content */
  details div::-webkit-scrollbar {
    width: 6px;
  }
  
  details div::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }
  
  details div::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 10px;
  }
  
  details div::-webkit-scrollbar-thumb:hover {
    background: #555;
  }
</style>

